<Window
	x:Name="MainWindow"
	x:Class="Laevo.View.ActivityOverview.ActivityOverviewWindow"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:ActivityOverview="clr-namespace:Laevo.View.ActivityOverview"
	xmlns:Binding="clr-namespace:Laevo.ViewModel.ActivityOverview.Binding"
	xmlns:Behaviors="clr-namespace:Whathecode.System.Xaml.Behaviors;assembly=Whathecode.PresentationFramework"
	xmlns:Converters="clr-namespace:Laevo.View.ActivityOverview.Converters"	
	Title="Laevo Activity Time Line"
	WindowStyle="None"
	WindowState="Maximized"
	ShowInTaskbar="False"
	Topmost="True"
	FontFamily="Segoe UI Light">
	
	<Window.CommandBindings>
		<CommandBinding
			Command="ActivityOverview:ActivityOverviewWindow.MouseDragged"
			Executed="MoveTimeLine" />	
	</Window.CommandBindings>
	
	<Window.Resources>
		<LinearGradientBrush x:Key="BackgroundBrush" StartPoint="0,0" EndPoint="0,1">
			<GradientStop Color="#606c88" Offset="0" />
			<GradientStop Color="#282944" Offset="1" />
		</LinearGradientBrush>
		<SolidColorBrush x:Key="TimeLineBrush" Color="Transparent" />
		
		<Converters:AspectRatioToGeometryConverter x:Key="AspectRatioToPositions" />
		<Converters:AspectRatioToFovConverter x:Key="AspectRatioToFov" />
		<Converters:AspectRatioToTransformOffset x:Key="AspectRatioToTransformOffset" />
		<Converters:TimeLineWidthConverter x:Key="TimeLineWidthConverter" />
		
		<ExponentialEase x:Key="EaseIn" EasingMode="EaseIn" Exponent="3" />
		<ExponentialEase x:Key="EaseOut" EasingMode="EaseOut" Exponent="3" />
	</Window.Resources>
	
	<Grid Background="{StaticResource BackgroundBrush}">

		<!-- Blur effect for popups. -->
		<Grid.Effect>
			<BlurEffect Radius="0" />
		</Grid.Effect>		
		<Grid.Style>
			<Style>
				<Style.Triggers>
					<DataTrigger Binding="{Binding ActivityMode}">
						<DataTrigger.Value>
							<Binding:Mode>Edit</Binding:Mode>
						</DataTrigger.Value>		
						<DataTrigger.Setters>
							<Setter Property="UIElement.IsHitTestVisible" Value="False" />
						</DataTrigger.Setters>
						<DataTrigger.EnterActions>
							<BeginStoryboard>
								<Storyboard>
									<DoubleAnimation
										Storyboard.TargetProperty="(Grid.Effect).(BlurEffect.Radius)"
										To="5" Duration="0:0:1"
										EasingFunction="{StaticResource EaseOut}" />
								</Storyboard>
							</BeginStoryboard>
						</DataTrigger.EnterActions>
						<DataTrigger.ExitActions>
							<BeginStoryboard>
								<Storyboard>
									<DoubleAnimation
										Storyboard.TargetProperty="(Grid.Effect).(BlurEffect.Radius)"
										To="0" Duration="0:0:1"
										EasingFunction="{StaticResource EaseIn}" />
								</Storyboard>
							</BeginStoryboard>							
						</DataTrigger.ExitActions>
					</DataTrigger>				
				</Style.Triggers>
			</Style>
		</Grid.Style>

		<!-- Time Line -->
		<Viewport3D ClipToBounds="False" RenderOptions.EdgeMode="Aliased">
			<Viewport3D.Camera>
				<PerspectiveCamera
					Position="0 0 1"
					LookDirection="0 0 -1"
					UpDirection="0 1 0">
					<PerspectiveCamera.FieldOfView>
						<MultiBinding Converter="{StaticResource AspectRatioToFov}">
							<Binding ElementName="MainWindow" Path="Width" />
							<Binding ElementName="MainWindow" Path="Height" />
						</MultiBinding>
					</PerspectiveCamera.FieldOfView>
				</PerspectiveCamera>
			</Viewport3D.Camera>

			<ContainerUIElement3D>
				<ModelUIElement3D>
					<AmbientLight Color="White" />
				</ModelUIElement3D>
			</ContainerUIElement3D>

			<Viewport2DVisual3D>
				<Viewport2DVisual3D.CacheMode>
					<BitmapCache />
				</Viewport2DVisual3D.CacheMode>

				<Viewport2DVisual3D.Transform>
					<RotateTransform3D>
						<RotateTransform3D.CenterX>
							<MultiBinding Converter="{StaticResource AspectRatioToTransformOffset}">
								<Binding ElementName="MainWindow" Path="Width" />
								<Binding ElementName="MainWindow" Path="Height" />
							</MultiBinding>
						</RotateTransform3D.CenterX>
						<RotateTransform3D.Rotation>
							<AxisAngleRotation3D
								Angle="10" />
						</RotateTransform3D.Rotation>
					</RotateTransform3D>
				</Viewport2DVisual3D.Transform>

				<Viewport2DVisual3D.Geometry>
					<MeshGeometry3D
						TriangleIndices="0,1,2 2,3,0"
						TextureCoordinates="0 0, 0 1, 1 1, 1 0">
						<MeshGeometry3D.Positions>
							<MultiBinding Converter="{StaticResource AspectRatioToPositions}">
								<Binding ElementName="MainWindow" Path="ActualWidth" />
								<Binding ElementName="MainWindow" Path="ActualHeight" />
							</MultiBinding>
						</MeshGeometry3D.Positions>
					</MeshGeometry3D>
				</Viewport2DVisual3D.Geometry>
				
				<Viewport2DVisual3D.Material>
					<DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True" />
				</Viewport2DVisual3D.Material>

				<Grid
					Width="{Binding ElementName=MainWindow, Path=ActualWidth, Converter={StaticResource TimeLineWidthConverter}}"
					Height="{Binding ElementName=MainWindow, Path=ActualHeight}"
					ClipToBounds="True"
					Background="{StaticResource TimeLineBrush}"
					Behaviors:MouseBehavior.LeftClickDragCommand="ActivityOverview:ActivityOverviewWindow.MouseDragged"
					Behaviors:MouseBehavior.DragCapturesMouse="False"
					MouseWheel="OnMouseWheel"
					MouseMove="OnMouseMoved">				
					
					<ActivityOverview:TimeLineControl
						x:Name="TimeLine"
						Focusable="True" />

				</Grid>				
			</Viewport2DVisual3D>
		</Viewport3D>
		
		<!-- Clock -->
		<ActivityOverview:ClockControl
			Time="{Binding CurrentTime}"
			HorizontalAlignment="Right"
			VerticalAlignment="Bottom" />

		<!-- Background drop for popups. -->
		<Grid
			x:Name="Shadow"
			Background="Black"
			Opacity="0"
			IsHitTestVisible="False"
			ZIndex="100">
			<Grid.Style>
				<Style>
					<Style.Triggers>
						<DataTrigger Binding="{Binding ActivityMode}">
							<DataTrigger.Value>
								<Binding:Mode>Edit</Binding:Mode>
							</DataTrigger.Value>
							<DataTrigger.EnterActions>
								<BeginStoryboard>
									<Storyboard>
										<DoubleAnimation
											Storyboard.TargetProperty="Opacity"
											To="0.6" Duration="0:0:1"
											EasingFunction="{StaticResource EaseOut}" />
									</Storyboard>
								</BeginStoryboard>
							</DataTrigger.EnterActions>
							<DataTrigger.ExitActions>
								<BeginStoryboard>
									<Storyboard>
										<DoubleAnimation
											Storyboard.TargetProperty="Opacity"
											To="0" Duration="0:0:1"
											EasingFunction="{StaticResource EaseIn}" />
									</Storyboard>
								</BeginStoryboard>								
							</DataTrigger.ExitActions>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</Grid.Style>
		</Grid>
		
	</Grid>

	<!-- No 3D. -->
	<!--<Grid
		Background="{StaticResource BackgroundBrush}"
		Behaviors:MouseBehavior.LeftClickDragCommand="ActivityOverview:ActivityOverviewWindow.MouseDragged"
		MouseWheel="OnMouseWheel"
		MouseMove="OnMouseMoved">

		<ActivityOverview:TimeLineControl x:Name="TimeLine" Focusable="True">
			<ActivityOverview:TimeLineControl.CommandBindings>
				<CommandBinding
					Command="ActivityOverview:ActivityOverviewWindow.MouseDragged"					
					Executed="MoveTimeLine" />
			</ActivityOverview:TimeLineControl.CommandBindings>
		</ActivityOverview:TimeLineControl>
		
	</Grid>-->

</Window>